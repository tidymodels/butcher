<!DOCTYPE html>
<!-- Generated by pkgdown: do not edit by hand --><html lang="en">
<head>
<meta http-equiv="Content-Type" content="text/html; charset=UTF-8">
<meta charset="utf-8">
<meta http-equiv="X-UA-Compatible" content="IE=edge">
<meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">
<title>Adding models to butcher • butcher</title>
<script src="../deps/jquery-3.6.0/jquery-3.6.0.min.js"></script><meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">
<link href="../deps/bootstrap-5.3.1/bootstrap.min.css" rel="stylesheet">
<script src="../deps/bootstrap-5.3.1/bootstrap.bundle.min.js"></script><link href="../deps/Source_Sans_Pro-0.4.10/font.css" rel="stylesheet">
<link href="../deps/Source_Code_Pro-0.4.10/font.css" rel="stylesheet">
<link href="../deps/font-awesome-6.5.2/css/all.min.css" rel="stylesheet">
<link href="../deps/font-awesome-6.5.2/css/v4-shims.min.css" rel="stylesheet">
<script src="../deps/headroom-0.11.0/headroom.min.js"></script><script src="../deps/headroom-0.11.0/jQuery.headroom.min.js"></script><script src="../deps/bootstrap-toc-1.0.1/bootstrap-toc.min.js"></script><script src="../deps/clipboard.js-2.0.11/clipboard.min.js"></script><script src="../deps/search-1.0.0/autocomplete.jquery.min.js"></script><script src="../deps/search-1.0.0/fuse.min.js"></script><script src="../deps/search-1.0.0/mark.min.js"></script><!-- pkgdown --><script src="../pkgdown.js"></script><meta property="og:title" content="Adding models to butcher">
<meta name="robots" content="noindex">
<script src="https://cdn.jsdelivr.net/gh/posit-dev/supported-by-posit/js/badge.min.js" data-max-height="43" data-light-bg="#666f76" data-light-fg="#f9f9f9"></script><script defer data-domain="butcher.tidymodels.org,all.tidymodels.org" src="https://plausible.io/js/plausible.js"></script>
</head>
<body>
    <a href="#container" class="visually-hidden-focusable">Skip to content</a>


    <nav class="navbar navbar-expand-lg fixed-top bg-none" data-bs-theme="light" aria-label="Site navigation"><div class="container">

    <a class="navbar-brand me-2" href="../index.html">butcher</a>

    <small class="nav-text text-danger me-auto" data-bs-toggle="tooltip" data-bs-placement="bottom" title="In-development version">0.3.6.9000</small>


    <button class="navbar-toggler" type="button" data-bs-toggle="collapse" data-bs-target="#navbar" aria-controls="navbar" aria-expanded="false" aria-label="Toggle navigation">
      <span class="navbar-toggler-icon"></span>
    </button>

    <div id="navbar" class="collapse navbar-collapse ms-3">
      <ul class="navbar-nav me-auto">
<li class="nav-item"><a class="nav-link" href="../articles/butcher.html">Get started</a></li>
<li class="nav-item"><a class="nav-link" href="../reference/index.html">Reference</a></li>
<li class="active nav-item dropdown">
  <button class="nav-link dropdown-toggle" type="button" id="dropdown-articles" data-bs-toggle="dropdown" aria-expanded="false" aria-haspopup="true">Articles</button>
  <ul class="dropdown-menu" aria-labelledby="dropdown-articles">
<li><a class="dropdown-item" href="../articles/adding-models-to-butcher.html">Adding models to butcher</a></li>
    <li><a class="dropdown-item" href="../articles/available-axe-methods.html">Available axe methods</a></li>
  </ul>
</li>
<li class="nav-item"><a class="nav-link" href="../news/index.html">Changelog</a></li>
      </ul>
<ul class="navbar-nav">
<li class="nav-item"><form class="form-inline" role="search">
 <input class="form-control" type="search" name="search-input" id="search-input" autocomplete="off" aria-label="Search site" placeholder="Search for" data-search-index="../search.json">
</form></li>
<li class="nav-item"><a class="external-link nav-link" href="https://github.com/tidymodels/butcher/" aria-label="GitHub"><span class="fa fab fa-github fa-lg"></span></a></li>
      </ul>
</div>


  </div>
</nav><div class="container template-article" id="container">




<div class="row">
  <main id="main" class="col-md-9"><div class="page-header">
      <img src="../logo.png" class="logo" alt=""><h1>Adding models to butcher</h1>
            
      
      <small class="dont-index">Source: <a href="https://github.com/tidymodels/butcher/blob/main/vignettes/adding-models-to-butcher.Rmd" class="external-link"><code>vignettes/adding-models-to-butcher.Rmd</code></a></small>
      <div class="d-none name"><code>adding-models-to-butcher.Rmd</code></div>
    </div>

    
    
<div class="sourceCode" id="cb1"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="kw"><a href="https://rdrr.io/r/base/library.html" class="external-link">library</a></span><span class="op">(</span><span class="va"><a href="https://butcher.tidymodels.org/">butcher</a></span><span class="op">)</span></span></code></pre></div>
<p>If you come across any model objects that should be subject to
butchering but does not exist in our current repository as listed <a href="https://www.tidymodels.org/find/parsnip/" class="external-link">here</a>, please
consider becoming a contributor to this package! For any first time
contributors, this is a great place to start as we’ve created templates
that make this process as seamless as possible.</p>
<p>Let’s say our new model object, of class <code>blob</code>, was
generated from an R package called “blobber”. If you want to add axe
methods for this class, first clone butcher onto your local computer and
open up RStudio (use
<code>usethis::create_from_github("tidymodels/butcher")</code> for an
automated way to do this). After you have opened RStudio and are in the
butcher RStudio project, run:</p>
<div class="sourceCode" id="cb2"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb2-1"><a href="#cb2-1" tabindex="-1"></a><span class="sc">&gt;</span> <span class="fu">new_model_butcher</span>(<span class="at">model_class =</span> <span class="st">"blob"</span>, <span class="at">package_name =</span> <span class="st">"blobber"</span>)</span></code></pre></div>
<p>You’ll get the following console messages:</p>
<div class="sourceCode" id="cb3"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb3-1"><a href="#cb3-1" tabindex="-1"></a>✔ Setting active project to <span class="st">'path_to_butcher_package'</span></span>
<span id="cb3-2"><a href="#cb3-2" tabindex="-1"></a>✔ Adding <span class="st">'blobber'</span> to Suggests field <span class="cf">in</span> DESCRIPTION</span>
<span id="cb3-3"><a href="#cb3-3" tabindex="-1"></a>● Use <span class="st">`</span><span class="at">requireNamespace("blobber", quietly = TRUE)</span><span class="st">`</span> to test <span class="cf">if</span> package is installed</span>
<span id="cb3-4"><a href="#cb3-4" tabindex="-1"></a>● Then directly refer to functons like <span class="st">`</span><span class="at">blobber::fun()</span><span class="st">`</span> (replacing <span class="st">`</span><span class="at">fun()</span><span class="st">`</span>).</span>
<span id="cb3-5"><a href="#cb3-5" tabindex="-1"></a></span>
<span id="cb3-6"><a href="#cb3-6" tabindex="-1"></a>ℹ Writing skeleton files</span>
<span id="cb3-7"><a href="#cb3-7" tabindex="-1"></a>✔ Writing <span class="st">'R/blob.R'</span></span>
<span id="cb3-8"><a href="#cb3-8" tabindex="-1"></a>✔ Writing <span class="st">'tests/testthat/test-blob.R'</span></span>
<span id="cb3-9"><a href="#cb3-9" tabindex="-1"></a>● Modify <span class="st">'R/blob.R'</span></span>
<span id="cb3-10"><a href="#cb3-10" tabindex="-1"></a>● Modify <span class="st">'tests/testthat/test-blob.R'</span></span></code></pre></div>
<p><code><a href="../reference/new_model_butcher.html">new_model_butcher()</a></code> leverages usethis to:</p>
<ol style="list-style-type: decimal">
<li>Add the new blobber modeling package under <code>Suggests</code> in
the butcher package description file.</li>
<li>Generate a skeleton file under the <code>/R</code> directory with
all possible axe methods for <code>blob</code>.</li>
<li>Generate an associated test file under <code>/tests/testthat</code>
to test new <code>blob</code> axe methods.</li>
</ol>
<p>As you can see in the R scripts for other model objects in this
package, <em>not all</em> axe generics are always used. In fact, if you
take a look at the <code>elnet.R</code> script, the only component of
the model object fit from the package <code>glmnet</code> that is worth
axing is the <code>call</code>. To help target what is worth removing
from <code>blob</code>, we recommend first beginning with
<code><a href="../reference/weigh.html">weigh()</a></code> to identify which parts of the model object take up
the most memory.</p>
<div class="sourceCode" id="cb4"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb4-1"><a href="#cb4-1" tabindex="-1"></a><span class="sc">&gt;</span> <span class="fu">weigh</span>(fitted_blob_object)</span>
<span id="cb4-2"><a href="#cb4-2" tabindex="-1"></a><span class="co"># A tibble: 25 x 2</span></span>
<span id="cb4-3"><a href="#cb4-3" tabindex="-1"></a>   object            size</span>
<span id="cb4-4"><a href="#cb4-4" tabindex="-1"></a>   <span class="sc">&lt;</span>chr<span class="sc">&gt;</span>            <span class="er">&lt;</span>dbl<span class="sc">&gt;</span></span>
<span id="cb4-5"><a href="#cb4-5" tabindex="-1"></a> <span class="dv">1</span> terms         <span class="fl">4.01</span>    </span>
<span id="cb4-6"><a href="#cb4-6" tabindex="-1"></a> <span class="dv">2</span> qr.qr         <span class="fl">0.00666</span> </span>
<span id="cb4-7"><a href="#cb4-7" tabindex="-1"></a> <span class="dv">3</span> residuals     <span class="fl">0.00286</span> </span>
<span id="cb4-8"><a href="#cb4-8" tabindex="-1"></a> <span class="dv">4</span> fitted.values <span class="fl">0.00286</span> </span>
<span id="cb4-9"><a href="#cb4-9" tabindex="-1"></a> <span class="dv">5</span> effects       <span class="fl">0.0014</span>  </span>
<span id="cb4-10"><a href="#cb4-10" tabindex="-1"></a> <span class="dv">6</span> coefficients  <span class="fl">0.00109</span> </span>
<span id="cb4-11"><a href="#cb4-11" tabindex="-1"></a> <span class="dv">7</span> call          <span class="fl">0.000728</span></span>
<span id="cb4-12"><a href="#cb4-12" tabindex="-1"></a> <span class="dv">8</span> model.mpg     <span class="fl">0.000304</span></span>
<span id="cb4-13"><a href="#cb4-13" tabindex="-1"></a> <span class="dv">9</span> model.cyl     <span class="fl">0.000304</span></span>
<span id="cb4-14"><a href="#cb4-14" tabindex="-1"></a><span class="dv">10</span> model.disp    <span class="fl">0.000304</span></span>
<span id="cb4-15"><a href="#cb4-15" tabindex="-1"></a><span class="co"># … with 15 more rows</span></span></code></pre></div>
<p>In this example, the fitted model objected generated from blobber has
a <code>terms</code> component that is taking 4.01 Mb. From here, you
can examine the structure of this terms component by leveraging
<code>lobstr::sxp(fitted_blob_object$terms)</code> or simply running
<code>utils::str(fitted_blob_object$terms)</code>. If you are looking to
hunt for a specific component like the environment, fitted values,
training data, controls, or the call object, take a look at
<code><a href="../reference/locate.html">locate()</a></code>.</p>
<p>Perhaps for our <code>blob</code> model object, we find that the
<code>call</code> is the only piece worth axing (replacing/removing).
The <code>R/blob.R</code> skeleton would be completed by adding a
placeholder for the original call.</p>
<div class="sourceCode" id="cb5"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="co">#' Axing a blob.</span></span>
<span><span class="co">#'</span></span>
<span><span class="co">#' blob model objects are created from the blobber package. They are</span></span>
<span><span class="co">#' generally leveraged for classification ... insert anything relevant </span></span>
<span><span class="co">#' ... This is where all the blob specific documentation lies.</span></span>
<span><span class="co">#'</span></span>
<span><span class="co">#' @param x Model object.</span></span>
<span><span class="co">#' @param verbose Print information each time an axe method is executed</span></span>
<span><span class="co">#'  that notes how much memory is released and what functions are</span></span>
<span><span class="co">#'  disabled. Default is \code{TRUE}.</span></span>
<span><span class="co">#' @param ... Any additional arguments related to axing.</span></span>
<span><span class="co">#'</span></span>
<span><span class="co">#' @return Axed model object.</span></span>
<span><span class="co">#'</span></span>
<span><span class="co">#' @name axe-blob</span></span>
<span><span class="cn">NULL</span></span>
<span></span>
<span><span class="co">#' Remove the call.</span></span>
<span><span class="co">#'</span></span>
<span><span class="co">#' @rdname axe-blob</span></span>
<span><span class="co">#' @export</span></span>
<span><span class="va">axe_call.blob</span> <span class="op">&lt;-</span> <span class="kw">function</span><span class="op">(</span><span class="va">x</span>, <span class="va">verbose</span> <span class="op">=</span> <span class="cn">TRUE</span>, <span class="va">...</span><span class="op">)</span> <span class="op">{</span></span>
<span>  <span class="va">old</span> <span class="op">&lt;-</span> <span class="va">x</span></span>
<span>  <span class="va">x</span> <span class="op">&lt;-</span> <span class="fu">exchange</span><span class="op">(</span><span class="va">x</span>, <span class="st">"call"</span>, <span class="fu"><a href="https://rdrr.io/r/base/call.html" class="external-link">call</a></span><span class="op">(</span><span class="st">"dummy_call"</span><span class="op">)</span><span class="op">)</span></span>
<span>  <span class="kw">if</span> <span class="op">(</span><span class="va">verbose</span><span class="op">)</span> <span class="op">{</span></span>
<span>    <span class="fu"><a href="../reference/ui.html">assess_object</a></span><span class="op">(</span></span>
<span>      <span class="va">old</span>, </span>
<span>      <span class="va">x</span>,</span>
<span>      disabled <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="st">"print"</span>, <span class="st">"summary"</span><span class="op">)</span></span>
<span>    <span class="op">)</span></span>
<span>  <span class="op">}</span></span>
<span>  <span class="fu">add_butcher_class</span><span class="op">(</span><span class="va">x</span><span class="op">)</span></span>
<span><span class="op">}</span></span></code></pre></div>
<p>Here we assign the current blob object <code>x</code> to the variable
<code>old</code> as a means to evaluate the memory released once
<code><a href="../reference/axe_call.html">axe_call()</a></code> is executed on the original model object. Next,
we actually <code>exchange()</code> the current call with a dummy call
of a (hopefully) smaller size. We also include
<code><a href="../reference/ui.html">assess_object()</a></code> with the additional string parameter of
<code>disabled</code> so console messages will be printed out, alerting
users of any downstream functions that would be affected by axing the
call. Since the original model object has different components than the
new one, we add an additional <code>butcher_blob</code> class by calling
<code>add_butcher_class()</code> at the end of each axe method. Once the
axe methods are set, we then have a skeleton file
<code>tests/testthat/test-blob.R</code> to aid in any unit testing.</p>
<div class="section level2">
<h2 id="recap">Recap<a class="anchor" aria-label="anchor" href="#recap"></a>
</h2>
<p>Adding a new model object to butcher:</p>
<ol style="list-style-type: decimal">
<li>Run
<code>new_model_butcher(model_class = "blob", package_name = "blobber")</code>
</li>
<li>Use butcher helper functions <code><a href="../reference/weigh.html">weigh()</a></code> and
<code><a href="../reference/locate.html">locate()</a></code> to decide what to axe</li>
<li>Finalize edits to <code>R/blob.R</code> and
<code>tests/testthat/test-blob.R</code>
</li>
<li>Make a pull request!</li>
</ol>
</div>
  </main>
</div>



   </div>
  <footer><div class="container">
  <div class="pkgdown-footer-left">
  <p>Developed by Joyce Cahoon, <a href="https://github.com/DavisVaughan" class="external-link">Davis Vaughan</a>, <a href="https://github.com/topepo" class="external-link">Max Kuhn</a>, Alex Hayes, <a href="https://juliasilge.com/" class="external-link">Julia Silge</a>, <a href="https://www.posit.co" class="external-link"><img src="https://www.tidyverse.org/posit-logo.svg" alt="Posit" height="16" width="62" style="margin-bottom: 3px;"></a>.</p>
</div>

<div class="pkgdown-footer-right">
  <p>Site built with <a href="https://pkgdown.r-lib.org/" class="external-link">pkgdown</a> 2.2.0.</p>
</div>

  </div></footer>
</body>
</html>
